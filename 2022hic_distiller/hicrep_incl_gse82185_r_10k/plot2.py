#!/usr/bin/env python3
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
samples = [
    "2c_17hpi_No1",
    "2c_17hpi_No2",
    "2c_control_No1",
    "2c_control_No2",
    "2c_H3-1_and_3-2KD_No1",
    "2c_H3-1_and_3-2KD_No2",
    "GSE82185_early2C_No1",
    "GSE82185_early2C_No2",
    "GSE82185_early2C_No3",
    "GSE82185_late2C_No1",
    "GSE82185_late2C_No2",
    "GSE82185_late2C_No3",
    "GSE82185_late2C_No4",
    "GSE80006_3_oocyte_SN",
    "GSE80006_8_oocyte_SN",
    "GSE80006_13_oocyte_SN",
    "GSE80006_14_oocyte_SN",
    "GSE80006_20_oocyte_SN",
    "GSE80006_27_oocyte_SN",
    #"GSE80006_29_oocyte_SN",
    #"GSE80006_31_oocyte_SN",
    #"GSE80006_35_oocyte_SN",
    #"GSE80006_37_oocyte_SN",
    #"GSE80006_39_oocyte_SN",
    #"GSE80006_46_oocyte_SN",
    #"GSE80006_51_oocyte_SN",
    #"GSE80006_68_oocyte_SN",
    #"GSE80006_82_oocyte_SN",
    #"GSE80006_83_oocyte_SN",
    #"GSE80006_99_oocyte_SN",
    #"GSE80006_101_oocyte_SN",
    #"GSE80006_114_oocyte_SN",
    #"GSE80006_122_oocyte_SN",
    #"GSE80006_125_oocyte_SN",
    #"GSE80006_130_oocyte_SN",
    #"GSE80006_132_oocyte_SN",
    #"GSE80006_144_oocyte_SN",
    #"GSE80006_150_oocyte_SN",
    #"GSE80006_161_oocyte_SN",
    #"GSE80006_163_oocyte_SN",
    #"GSE80006_165_oocyte_SN",
    #"GSE80006_167_oocyte_SN",
    #"GSE80006_170_oocyte_SN",
    #"GSE80006_172_oocyte_SN",
    #"GSE80006_173_oocyte_SN",
    #"GSE80006_174_oocyte_SN",
    #"GSE80006_175_oocyte_SN",
    #"GSE80006_177_oocyte_SN",
    #"GSE80006_181_oocyte_SN",
    #"GSE80006_185_oocyte_SN",
    #"GSE80006_191_oocyte_SN",
    #"GSE80006_194_oocyte_SN",
    #"GSE80006_219_oocyte_SN",
    "GSE80006_1_oocyte_NSN",
    "GSE80006_4_oocyte_NSN",
    "GSE80006_5_oocyte_NSN",
    "GSE80006_10_oocyte_NSN",
    "GSE80006_12_oocyte_NSN",
    "GSE80006_15_oocyte_NSN",
    #"GSE80006_17_oocyte_NSN",
    #"GSE80006_25_oocyte_NSN",
    #"GSE80006_30_oocyte_NSN",
    #"GSE80006_32_oocyte_NSN",
    #"GSE80006_40_oocyte_NSN",
    #"GSE80006_41_oocyte_NSN",
    #"GSE80006_44_oocyte_NSN",
    #"GSE80006_47_oocyte_NSN",
    #"GSE80006_48_oocyte_NSN",
    #"GSE80006_55_oocyte_NSN",
    #"GSE80006_59_oocyte_NSN",
    #"GSE80006_62_oocyte_NSN",
    #"GSE80006_65_oocyte_NSN",
    #"GSE80006_134_oocyte_NSN",
    #"GSE80006_152_oocyte_NSN",
    #"GSE80006_153_oocyte_NSN",
    #"GSE80006_155_oocyte_NSN",
    #"GSE80006_159_oocyte_NSN",
    #"GSE80006_168_oocyte_NSN",
    #"GSE80006_180_oocyte_NSN",
    #"GSE80006_182_oocyte_NSN",
    #"GSE80006_189_oocyte_NSN",
    #"GSE80006_218_oocyte_NSN",
    "oocyte_SN",
    "oocyte_NSN",
    ]
sample_names = [
    "Early 2-cell #1",
    "Early 2-cell #2",
    "Late 2-cell Control #1",
    "Late 2-cell Control #2",
    "Late 2-cell H3.1/3.2 KD #1",
    "Late 2-cell H3.1/3.2 KD #2",
    "GSE82185 Early 2-cell #1",
    "GSE82185 Early 2-cell #2",
    "GSE82185 Early 2-cell #3",
    "GSE82185 Late 2-cell #1",
    "GSE82185 Late 2-cell #2",
    "GSE82185 Late 2-cell #3",
    "GSE82185 Late 2-cell #4",
    "GSE80006 SN oocyte #3",
    "GSE80006 SN oocyte #8",
    "GSE80006 SN oocyte #13",
    "GSE80006 SN oocyte #14",
    "GSE80006 SN oocyte #20",
    "GSE80006 SN oocyte #27",
    #"GSE80006 SN oocyte #29",
    #"GSE80006 SN oocyte #31",
    #"GSE80006 SN oocyte #35",
    #"GSE80006 SN oocyte #37",
    #"GSE80006 SN oocyte #39",
    #"GSE80006 SN oocyte #46",
    #"GSE80006 SN oocyte #51",
    #"GSE80006 SN oocyte #68",
    #"GSE80006 SN oocyte #82",
    #"GSE80006 SN oocyte #83",
    #"GSE80006 SN oocyte #99",
    #"GSE80006 SN oocyte #101",
    #"GSE80006 SN oocyte #114",
    #"GSE80006 SN oocyte #122",
    #"GSE80006 SN oocyte #125",
    #"GSE80006 SN oocyte #130",
    #"GSE80006 SN oocyte #132",
    #"GSE80006 SN oocyte #144",
    #"GSE80006 SN oocyte #150",
    #"GSE80006 SN oocyte #161",
    #"GSE80006 SN oocyte #163",
    #"GSE80006 SN oocyte #165",
    #"GSE80006 SN oocyte #167",
    #"GSE80006 SN oocyte #170",
    #"GSE80006 SN oocyte #172",
    #"GSE80006 SN oocyte #173",
    #"GSE80006 SN oocyte #174",
    #"GSE80006 SN oocyte #175",
    #"GSE80006 SN oocyte #177",
    #"GSE80006 SN oocyte #181",
    #"GSE80006 SN oocyte #185",
    #"GSE80006 SN oocyte #191",
    #"GSE80006 SN oocyte #194",
    #"GSE80006 SN oocyte #219",
    "GSE80006 NSN oocyte #1",
    "GSE80006 NSN oocyte #4",
    "GSE80006 NSN oocyte #5",
    "GSE80006 NSN oocyte #10",
    "GSE80006 NSN oocyte #12",
    "GSE80006 NSN oocyte #15",
    #"GSE80006 NSN oocyte #17",
    #"GSE80006 NSN oocyte #25",
    #"GSE80006 NSN oocyte #30",
    #"GSE80006 NSN oocyte #32",
    #"GSE80006 NSN oocyte #40",
    #"GSE80006 NSN oocyte #41",
    #"GSE80006 NSN oocyte #44",
    #"GSE80006 NSN oocyte #47",
    #"GSE80006 NSN oocyte #48",
    #"GSE80006 NSN oocyte #55",
    #"GSE80006 NSN oocyte #59",
    #"GSE80006 NSN oocyte #62",
    #"GSE80006 NSN oocyte #65",
    #"GSE80006 NSN oocyte #134",
    #"GSE80006 NSN oocyte #152",
    #"GSE80006 NSN oocyte #153",
    #"GSE80006 NSN oocyte #155",
    #"GSE80006 NSN oocyte #159",
    #"GSE80006 NSN oocyte #168",
    #"GSE80006 NSN oocyte #180",
    #"GSE80006 NSN oocyte #182",
    #"GSE80006 NSN oocyte #189",
    #"GSE80006 NSN oocyte #218",
    "GSE80006 40 SN oocytes",
    "GSE80006 29 NSN oocytes",
    ]
similarities = np.empty((len(samples), len(samples)))
for i in range(len(samples)):
    for j in range(i, len(samples)):
        if i == j:
            similarities[i, j] = 1.0
        else:
            hicrep_path = f"hicrep_out.{samples[i]}.{samples[j]}.csv"
            d = pd.read_csv(hicrep_path)
            similarities[i, j] = d.iloc[:,1].median()
            similarities[j, i] = similarities[i, j]
print(similarities)
fig, ax = plt.subplots(figsize=(15,13))
#image = ax.matshow(similarities, cmap="inferno")
image = ax.matshow(similarities, cmap="coolwarm", vmin=-1, vmax=1)
ax.set_xticks(ticks=range(len(samples)), labels=sample_names, rotation=90)
ax.set_yticks(ticks=range(len(samples)), labels=sample_names, rotation=0)
fig.colorbar(image, label="Stratum-adjusted Correlation Coefficient")
for ((x, y), v) in np.ndenumerate(similarities):
    ax.text(y, x, f"{v:.2f}", ha="center", va="center")
fig.tight_layout()
fig.savefig("plot2.matrix.png", dpi=300)
